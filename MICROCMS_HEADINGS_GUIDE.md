# microCMS見出し設定ガイド（目次機能）

このガイドでは、microCMSでリッチエディタV2を使用した記事に目次を表示するための見出し設定方法を説明します。

## 📋 前提条件

- microCMSの「blog」APIに「headings」フィールドが追加されていること
- 記事で「contentHtml」（リッチエディタV2）を使用していること

## 🏗️ microCMSスキーマ設定

### 1. headingsフィールドの追加

microCMS管理画面で以下のフィールドを追加してください:

```
フィールドID: headings
表示名: 見出し（目次用）
種類: 繰り返しフィールド
必須: いいえ
```

### 2. 繰り返しフィールド内の設定

`headings`繰り返しフィールド内に以下の2つのフィールドを追加:

#### 2-1. text（見出しテキスト）
```
フィールドID: text
表示名: 見出しテキスト
種類: テキストフィールド
必須: はい
説明: 記事内の見出しと完全一致するテキストを入力
```

#### 2-2. level（見出しレベル）
```
フィールドID: level
表示名: 見出しレベル
種類: セレクトフィールド
必須: はい
選択肢:
  - 2 (h2)
  - 3 (h3)
  - 4 (h4)
  - 5 (h5)
  - 6 (h6)
説明: h1はタイトル専用のため、h2〜h6から選択
```

## ✍️ 記事作成時の手順

### Step 1: リッチエディタで記事を作成

1. 「contentHtml」フィールド（リッチエディタV2）で記事を執筆
2. 目次に表示したい箇所に見出し（h2〜h6）を設定
3. 見出しテキストを正確に覚えておく

例:
```html
<h2>背景と課題</h2>
<p>本文...</p>

<h2>解決策</h2>
<p>本文...</p>

<h3>実装例</h3>
<p>本文...</p>
```

### Step 2: headingsフィールドに見出し情報を入力

リッチエディタで設定した見出しを、**記事に登場する順番で** `headings` フィールドに追加:

| text | level |
|------|-------|
| 背景と課題 | 2 |
| 解決策 | 2 |
| 実装例 | 3 |

### Step 3: 保存して確認

1. 記事を保存
2. プレビューまたは本番サイトで目次が正しく表示されるか確認

## ⚠️ 重要な注意事項

### 1. 見出しテキストの完全一致

`headings[].text` は、`contentHtml` 内の見出しテキストと**完全一致**する必要があります。

❌ **NG例**（不一致）:
```
contentHtml: <h2>背景と課題について</h2>
headings[0].text: "背景と課題"  // 「について」が欠けている
```

✅ **OK例**（完全一致）:
```
contentHtml: <h2>背景と課題について</h2>
headings[0].text: "背景と課題について"
```

### 2. 見出しの順序

`headings` の順序は、記事内で見出しが登場する順番と一致させてください。

### 3. h1は使用不可

h1は記事タイトル専用です。本文ではh2〜h6を使用してください。

### 4. 同じ見出しが複数回登場する場合

同じテキストの見出しが複数回登場する場合、システムが自動的にユニークなIDを生成します（例: `section-1`, `section-2`）。

## 🔧 トラブルシューティング

### 目次が表示されない

**原因1**: `headings` フィールドが空
- **対処**: headingsに少なくとも1つの見出しを追加

**原因2**: `headings[].text` が `contentHtml` の見出しと不一致
- **対処**: テキストを完全一致させる（スペース、句読点も含む）

**原因3**: `contentHtml` に見出しタグがない
- **対処**: リッチエディタで見出しを設定

### 目次のリンクが機能しない

**原因**: 見出しテキストの不一致またはIDが生成されていない
- **対処**: `headings[].text` を再確認し、完全一致させる

## 📝 実際の例

### bolt-new-ai-code-generatorの記事

```
contentHtml:
  <h2>Bolt.newとは？</h2>
  <p>Bolt.newは...</p>
  
  <h2>主な機能と特徴</h2>
  <p>...</p>
  
  <h3>1. AI駆動のフルスタック開発</h3>
  <p>...</p>
  
  <h3>2. リアルタイムプレビュー</h3>
  <p>...</p>

headings:
  [
    { text: "Bolt.newとは？", level: 2 },
    { text: "主な機能と特徴", level: 2 },
    { text: "1. AI駆動のフルスタック開発", level: 3 },
    { text: "2. リアルタイムプレビュー", level: 3 }
  ]
```

## 🚀 今後の改善案

- **自動抽出**: サーバーサイドでcontentHtmlから見出しを自動抽出する機能の追加
- **プレビュー**: microCMS管理画面で目次プレビューを表示
- **バリデーション**: headingsとcontentHtmlの整合性をチェックする機能

## 📚 関連ドキュメント

- [MICROCMS_BLOG_GUIDE.md](./MICROCMS_BLOG_GUIDE.md) - microCMSブログ統合ガイド
- [AGENTS.md](./AGENTS.md) - ブログ記事追加ワークフロー

---

**最終更新**: 2025-10-15  
**対象バージョン**: Next.js 15.5.4, microCMS API
