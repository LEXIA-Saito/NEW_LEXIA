# microCMS見出し管理ガイド（目次機能）

## 🎯 概要

このガイドは、microCMSのリッチエディタV2（`contentHtml`）で作成した記事に**目次（Table of Contents）**を表示するための設定方法を説明します。

**基本動作**: `contentHtml` 内の見出しタグ（h2〜h6）から自動的に目次が生成されます。

**カスタマイズ**: 特定の見出しだけを目次に表示したい場合は、`headingsText` フィールドに改行区切りで入力できます。

## ✅ 使い方

### 推奨方法: 自動抽出（運用負荷ゼロ）

1. microCMSの「contentHtml」フィールド（リッチエディタV2）で記事を執筆
2. 目次に表示したい箇所に見出し（h2〜h6）を設定
3. **完了！** — 見出しは自動的に抽出され、目次とアンカーリンクが生成されます

**`headingsText` フィールドの入力は不要です**

#### 例: 自動抽出

```html
<!-- contentHtml -->
<h2>Bolt.newとは？</h2>
<p>Bolt.newはAI駆動の...</p>

<h2>主な機能と特徴</h2>
<p>...</p>

<h3>1. AI駆動のフルスタック開発</h3>
<p>...</p>
```

→ **目次に自動表示**:
- Bolt.newとは？
- 主な機能と特徴
  - 1. AI駆動のフルスタック開発

### カスタマイズ方法: headingsTextフィールドで指定

特定の見出しだけを目次に表示したい場合、`headingsText` フィールドに改行区切りで入力します。

#### 入力フォーマット

```
見出し1
見出し2
## 見出し3
### 見出し4
```

- **レベル指定なし**: h2として扱われます
- **`##` で始まる**: h2として扱われます
- **`###` で始まる**: h3として扱われます
- **`####` で始まる**: h4として扱われます（最大h6まで）

#### 例: カスタマイズ

```
<!-- contentHtml -->
<h2>見出し1</h2>
<p>...</p>

<h2>見出し2</h2>
<p>...</p>

<h2>見出し3</h2>
<p>...</p>

<!-- headingsText -->
見出し1
見出し3
```

→ **目次に表示**: 見出し1と見出し3のみ（見出し2は非表示）

## 📝 microCMSスキーマ設定

### headingsTextフィールド（テキストエリア）- **オプショナル**

```json
{
  "fieldId": "headingsText",
  "name": "目次の見出し（オプショナル）",
  "kind": "textArea",
  "required": false,
  "description": "目次をカスタマイズしたい場合のみ使用。改行区切りで見出しを入力。空の場合はcontentHtmlから自動抽出されます。"
}
```

**注**: このフィールドは**完全にオプショナル**です。空の場合、`contentHtml` から全ての見出しが自動的に抽出されます。

## ⚠️ 重要な注意事項

### 1. 自動抽出の動作

- リッチエディタV2で設定したh2-h6タグが自動的に抽出されます
- `headingsText` フィールドが空の場合、**全ての見出しが目次に表示されます**
- `headingsText` フィールドに値がある場合、そちらが優先されます

### 2. 見出しテキストの完全一致（手動設定時のみ）

`headingsText` フィールドを手動設定する場合、入力したテキストは `contentHtml` 内の見出しテキストと**完全一致**する必要があります。

### 3. 見出しの順序（手動設定時のみ）

`headingsText` フィールドを手動設定する場合、入力順序は `contentHtml` での出現順と一致させてください。

### 4. パフォーマンス

自動抽出はサーバーサイドで実行されるため、パフォーマンスへの影響はほぼありません。

## 📖 完全な例

### 例1: 自動抽出（推奨）

```json
{
  "slug": "bolt-new-ai-code-generator",
  "title": "Bolt.new: AI駆動のフルスタックWeb開発プラットフォーム",
  "contentHtml": "<h2>Bolt.newとは？</h2><p>...</p><h2>主な機能</h2><p>...</p>",
  "headingsText": ""
}
```

→ 「Bolt.newとは？」「主な機能」が自動的に目次に表示されます

### 例2: カスタマイズ

```json
{
  "slug": "bolt-new-ai-code-generator",
  "title": "Bolt.new: AI駆動のフルスタックWeb開発プラットフォーム",
  "contentHtml": "<h2>Bolt.newとは？</h2><p>...</p><h2>主な機能</h2><p>...</p><h2>まとめ</h2><p>...</p>",
  "headingsText": "Bolt.newとは？\nまとめ"
}
```

→ 「Bolt.newとは？」「まとめ」のみが目次に表示されます（「主な機能」は非表示）

## 🚀 今後の改善案

- **プレビュー**: microCMS管理画面で目次プレビューを表示
- **バリデーション**: headingsTextとcontentHtmlの整合性をチェックする機能（手動設定時）
- **階層表示**: h3以降をインデント表示して視覚的な階層を強化

## 📚 関連ドキュメント

- [MICROCMS_BLOG_GUIDE.md](./MICROCMS_BLOG_GUIDE.md) - microCMSブログ統合ガイド
- [AGENTS.md](./AGENTS.md) - ブログ記事追加ワークフロー
- [TOC_IMPLEMENTATION.md](./TOC_IMPLEMENTATION.md) - 目次機能の技術実装詳細

---

**最終更新**: 2025-10-15（テキストエリア方式に移行）  
**対象バージョン**: Next.js 15.5.4, microCMS API, cheerio 1.0.0
